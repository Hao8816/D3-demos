<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>D3学习</title>
    <script src="lib/d3/d3.v3.min.js"></script>
    <style>


    </style>

</head>
<body>
<script type="text/javascript">

    var w = 800;
    var h = 800;


    var nodes = [
        { name: "目标实体" },
        { name: "人物1" },
        { name: "人物2" },
        { name: "公司1" },
        { name: "公司2" },
        { name: "公司3" },
        { name: "公司4" },
        { name: "公司5" },
        { name: "公司6" },
        { name: "公司7" },
        { name: "公司8" },
        { name: "公司9" },
        { name: "公司10" },
        { name: "公司11" },
        { name: "公司12" },
        { name: "公司13" },
        { name: "公司14" },
        { name: "其他" }
        ];

    var edges = [
        { source : 0 , target: 1 } ,
        { source : 0 , target: 2 } ,
        { source : 1 , target: 3 } ,
        { source : 2 , target: 3 } ,
        { source : 3 , target: 4 } ,
        { source : 3 , target: 8 } ,
        { source : 4 , target: 5 } ,
        { source : 4 , target: 6 } ,
        { source : 5 , target: 12 } ,
        { source : 6 , target: 7 } ,
        { source : 6 , target: 12 } ,
        { source : 7 , target: 12 } ,
        { source : 8 , target: 9 } ,
        { source : 9 , target: 10 } ,
        { source : 9 , target: 11 } ,
        { source : 10 , target: 12 } ,
        { source : 11 , target: 12 } ,
    ];

    var svg = d3.select('body')
            .append('svg')
            .attr('width',w).attr('height',h);


    var force = d3.layout.force()
            .nodes(nodes) //指定节点数组
            .links(edges) //指定连线数组
            .size([w,h]) //指定作用域范围
            .linkDistance(150) //指定连线长度
            .charge([-400]); //相互之间的作用力

    force.start();
    console.log(force)

    //添加连线
    var svg_edges = svg.selectAll("line")
            .data(edges)
            .enter()
            .append("line")
            .style("stroke","#ccc")
            .style("stroke-width",1);

    var color = d3.scale.category20();

    //添加节点
    var svg_nodes = svg.selectAll("circle")
            .data(nodes)
            .enter()
            .append("circle")
            .attr("r",10)
            .style("fill",function(d,i){
                return color(i);
            })
            .call(force.drag);  //使得节点能够拖动

    svg.selectAll("circle")
            .on("click", function(d){
                console.log(d)
                if (d3.event.defaultPrevented){
                    return;
                }
                alert("呃！点我干嘛")
            })

    //添加描述节点的文字
    var svg_texts = svg.selectAll("text")
            .data(nodes)
            .enter()
            .append("text")
            .style("fill", "black")
            .attr("dx", 0)
            .attr("dy", 25)
            .text(function(d){
                return d.name;
            });

    force.on("tick", function(){ //对于每一个时间间隔
        //更新连线坐标
        svg_edges.attr("x1",function(d){ return d.source.x; })
                .attr("y1",function(d){ return d.source.y; })
                .attr("x2",function(d){ return d.target.x; })
                .attr("y2",function(d){ return d.target.y; });

        //更新节点坐标
        svg_nodes.attr("cx",function(d){ return d.x; })
                .attr("cy",function(d){ return d.y; });

        //更新文字坐标
        svg_texts.attr("x", function(d){ return d.x; })
                .attr("y", function(d){ return d.y; });
    });


//
//
//
//    var w = 1280,
//            h = 800,
//            node,
//            link,
//            root;
//
//    var force = d3.layout.force()
//            .on("tick", tick)
//            .charge(function(d) { return d._children ? -d.size / 100 : -30; })
//            .linkDistance(function(d) { return d.target._children ? 80 : 30; })
//            .size([w, h - 160]);
//
//    var vis = d3.select("body").append("svg:svg")
//            .attr("width", w)
//            .attr("height", h);
//
//    d3.json("flare.json", function(json) {
//        root = json;
//        root.fixed = true;
//        root.x = w / 2;
//        root.y = h / 2 - 80;
//        update();
//    });
//
//    function update() {
//        var nodes = flatten(root),
//                links = d3.layout.tree().links(nodes);
//
//        // Restart the force layout.
//        force
//                .nodes(nodes)
//                .links(links)
//                .start();
//
//        // Update the links…
//        link = vis.selectAll("line.link")
//                .data(links, function(d) { return d.target.id; });
//
//        // Enter any new links.
//        link.enter().insert("svg:line", ".node")
//                .attr("class", "link")
//                .attr("x1", function(d) { return d.source.x; })
//                .attr("y1", function(d) { return d.source.y; })
//                .attr("x2", function(d) { return d.target.x; })
//                .attr("y2", function(d) { return d.target.y; });
//
//        // Exit any old links.
//        link.exit().remove();
//
//        // Update the nodes…
//        node = vis.selectAll("circle.node")
//                .data(nodes, function(d) { return d.id; })
//                .style("fill", color);
//
//        node.transition()
//                .attr("r", function(d) { return d.children ? 4.5 : Math.sqrt(d.size) / 10; });
//
//        // Enter any new nodes.
//        node.enter().append("svg:circle")
//                .attr("class", "node")
//                .attr("cx", function(d) { return d.x; })
//                .attr("cy", function(d) { return d.y; })
//                .attr("r", function(d) { return d.children ? 4.5 : Math.sqrt(d.size) / 10; })
//                .style("fill", color)
//                .on("click", click)
//                .call(force.drag);
//
//        // Exit any old nodes.
//        node.exit().remove();
//    }
//
//    function tick() {
//        link.attr("x1", function(d) { return d.source.x; })
//                .attr("y1", function(d) { return d.source.y; })
//                .attr("x2", function(d) { return d.target.x; })
//                .attr("y2", function(d) { return d.target.y; });
//
//        node.attr("cx", function(d) { return d.x; })
//                .attr("cy", function(d) { return d.y; });
//    }
//
//    // Color leaf nodes orange, and packages white or blue.
//    function color(d) {
//        return d._children ? "#3182bd" : d.children ? "#c6dbef" : "#fd8d3c";
//    }
//
//    // Toggle children on click.
//    function click(d) {
//        if (d.children) {
//            d._children = d.children;
//            d.children = null;
//        } else {
//            d.children = d._children;
//            d._children = null;
//        }
//        update();
//    }
//
//    // Returns a list of all nodes under the root.
//    function flatten(root) {
//        var nodes = [], i = 0;
//
//        function recurse(node) {
//            if (node.children) node.size = node.children.reduce(function(p, v) { return p + recurse(v); }, 0);
//            if (!node.id) node.id = ++i;
//            nodes.push(node);
//            return node.size;
//        }
//
//        root.size = recurse(root);
//        return nodes;
//    }
//



</script>
</body>
</html>