<html>
<head>
    <meta charset="utf-8">
    <title>Tree</title>
</head>

<style>

    .node {
        cursor: pointer;
    }
    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 1.5px;
    }
    .node text {
        font: 10px sans-serif;
    }
    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 1.5px;
    }

    body {
        overflow: hidden;
    }

</style>
<body>
<div id="body"></div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>


    var margin = {
                top: 20,
                right: 120,
                bottom: 20,
                left: 120
            },
            width = 960 - margin.right - margin.left,
            height = 800 - margin.top - margin.bottom;

    var root ={
                "name":"武汉健民总部",
                "children":
                        [
                            {
                                "name":"医院业务中心" ,
                                "children":
                                        [
                                            {
                                                "name":"医院事业特部",
                                                "children" : [
                                                    {"name":"湖北-恩施分公司"},
                                                    {"name":"湖北-黄冈分公司"},
                                                    {"name":"湖北-黄石分公司"},
                                                    {"name":"湖北-荆州分公司"},
                                                    {"name":"湖北-十堰分公司"},
                                                    {"name":"湖北-武汉分公司"},
                                                    {"name":"湖北-仙桃分公司"},
                                                    {"name":"湖北-襄阳分公司"},
                                                    {"name":"湖北-孝感分公司"},
                                                    {"name":"湖北-宜昌分公司"}
                                                ]
                                            },
                                            {
                                                "name":"疽证事业部",
                                                "children" : [
                                                    {
                                                        "name" : "疽证北大区",
                                                        "children" : [
                                                            {"name" : "疽证北大区-北京"},
                                                            {"name" : "疽证北大区-河北"},
                                                            {"name" : "疽证北大区-黑龙江"},
                                                            {"name" : "疽证北大区-吉林"},
                                                            {"name" : "疽证北大区-江西"},
                                                            {"name" : "疽证北大区-辽宁"},
                                                            {"name" : "疽证北大区-内蒙古"},
                                                            {"name" : "疽证北大区-山东"},
                                                            {"name" : "疽证北大区-山西"},
                                                            {"name" : "疽证北大区-天津"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "疽证南大区",
                                                        "children" : [
                                                            {"name" : "疽证北大区-福建"},
                                                            {"name" : "疽证北大区-广东"},
                                                            {"name" : "疽证北大区-广西"},
                                                            {"name" : "疽证北大区-海南"},
                                                            {"name" : "疽证北大区-湖南"},
                                                            {"name" : "疽证北大区-江苏"},
                                                            {"name" : "疽证北大区-上海"},
                                                            {"name" : "疽证北大区-浙江"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "疽证西大区",
                                                        "children" : [
                                                            {"name" : "疽证北大区-安徽"},
                                                            {"name" : "疽证北大区-甘肃"},
                                                            {"name" : "疽证北大区-贵州"},
                                                            {"name" : "疽证北大区-河南"},
                                                            {"name" : "疽证北大区-宁夏"},
                                                            {"name" : "疽证北大区-青海"},
                                                            {"name" : "疽证北大区-陕西"},
                                                            {"name" : "疽证北大区-四川"},
                                                            {"name" : "疽证北大区-新疆"},
                                                            {"name" : "疽证北大区-云南"},
                                                            {"name" : "疽证北大区-重庆"}
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "name":"虚证事业部",
                                                "children" : [
                                                    {
                                                        "name" : "虚证北大区",
                                                        "children" : [
                                                            {"name":"虚证北大区-北京"},
                                                            {"name":"虚证北大区-福建"},
                                                            {"name":"虚证北大区-河北"},
                                                            {"name":"虚证北大区-河南"},
                                                            {"name":"虚证北大区-黑龙江"},
                                                            {"name":"虚证北大区-吉林"},
                                                            {"name":"虚证北大区-辽宁"},
                                                            {"name":"虚证北大区-山东"},
                                                            {"name":"虚证北大区-上海"},
                                                            {"name":"虚证北大区-四川"},
                                                            {"name":"虚证北大区-天津"},
                                                            {"name":"虚证北大区-西藏"},
                                                            {"name":"虚证北大区-浙江"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "虚证南大区",
                                                        "children" : [
                                                            {"name":"虚证南大区-安徽"},
                                                            {"name":"虚证南大区-广东"},
                                                            {"name":"虚证南大区-广西"},
                                                            {"name":"虚证南大区-贵州"},
                                                            {"name":"虚证南大区-海南"},
                                                            {"name":"虚证南大区-湖南"},
                                                            {"name":"虚证南大区-江苏"},
                                                            {"name":"虚证南大区-江西"},
                                                            {"name":"虚证南大区-云南"},
                                                            {"name":"虚证南大区-重庆"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "虚证西大区",
                                                        "children" : [
                                                            {"name" : "虚证西大区-甘肃"},
                                                            {"name" : "虚证西大区-内蒙古"},
                                                            {"name" : "虚证西大区-宁夏"},
                                                            {"name" : "虚证西大区-青海"},
                                                            {"name" : "虚证西大区-山西"},
                                                            {"name" : "虚证西大区-新疆"},
                                                            {"name" : "虚证西大区-陕西"}
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "name":"龙牡事业部",
                                                "children" : [
                                                    {
                                                        "name" : "龙牡北大区",
                                                        "children" : [
                                                            {"name" : "龙牡北大区-北京"},
                                                            {"name" : "龙牡北大区-福建"},
                                                            {"name" : "龙牡北大区-河北"},
                                                            {"name" : "龙牡北大区-河南"},
                                                            {"name" : "龙牡北大区-黑龙江"},
                                                            {"name" : "龙牡北大区-吉林"},
                                                            {"name" : "龙牡北大区-辽宁"},
                                                            {"name" : "龙牡北大区-山东"},
                                                            {"name" : "龙牡北大区-上海"},
                                                            {"name" : "龙牡北大区-四川"},
                                                            {"name" : "龙牡北大区-天津"},
                                                            {"name" : "龙牡北大区-西藏"},
                                                            {"name" : "龙牡北大区-浙江"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "龙牡南大区",
                                                        "children" : [
                                                            {"name" : "龙牡南大区-安徽"},
                                                            {"name" : "龙牡南大区-广东"},
                                                            {"name" : "龙牡南大区-广西"},
                                                            {"name" : "龙牡南大区-贵州"},
                                                            {"name" : "龙牡南大区-海南"},
                                                            {"name" : "龙牡南大区-湖南"},
                                                            {"name" : "龙牡南大区-江苏"},
                                                            {"name" : "龙牡南大区-江西"},
                                                            {"name" : "龙牡南大区-云南"},
                                                            {"name" : "龙牡南大区-重庆"}
                                                        ]
                                                    },
                                                    {
                                                        "name" : "龙牡西大区",
                                                        "children" : [
                                                            {"name" : "龙牡西大区-甘肃"},
                                                            {"name" : "龙牡西大区-内蒙古"},
                                                            {"name" : "龙牡西大区-宁夏"},
                                                            {"name" : "龙牡西大区-青海"},
                                                            {"name" : "龙牡西大区-山西"},
                                                            {"name" : "龙牡西大区-新疆"},
                                                            {"name" : "龙牡西大区-陕西"}
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                            },
                            {
                                "name":"OTC业务中心" ,
                                "children": [
                                    {
                                        "name":"商务事业部",
                                        "children":[
                                            {
                                                "name":"商务南大区",
                                                "children": [
                                                    {"name":"商务湖北省区"},
                                                    {"name":"商务广东省区"},
                                                    {"name":"商务海南省区"},
                                                    {"name":"商务福建省区"},
                                                    {"name":"商务浙江省区"},
                                                    {"name":"商务上海省区"},
                                                    {"name":"商务江苏省区"},
                                                    {"name":"商务湖南省区"},
                                                    {"name":"商务江西省区"},
                                                    {"name":"商务安徽省区"}
                                                ]
                                            },
                                            {
                                                "name":"商务西大区",
                                                "children":[
                                                    {"name" :"商务广西省区"},
                                                    {"name" :"商务贵州省区"},
                                                    {"name" :"商务云南省区"},
                                                    {"name" :"商务甘肃省区"},
                                                    {"name" :"商务宁夏省区"},
                                                    {"name" :"商务青海省区"},
                                                    {"name" :"商务四川省区"},
                                                    {"name" :"商务新疆省区"},
                                                    {"name" :"商务陕西省区"},
                                                    {"name" :"商务重庆省区"}
                                                ]
                                            },
                                            {
                                                "name":"商务北大区",
                                                "children":[
                                                    {"name":"商务北京省区"},
                                                    {"name":"商务天津省区"},
                                                    {"name":"商务河北省区"},
                                                    {"name":"商务山西省区"},
                                                    {"name":"商务河南省区"},
                                                    {"name":"商务辽宁省区"},
                                                    {"name":"商务山东省区"},
                                                    {"name":"商务吉林省区"},
                                                    {"name":"商务黑龙江省区"}
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "name":"菁合事业部",
                                        "children":[
                                            {
                                                "name":"菁合北大区",
                                                "children":[
                                                    {"name":"菁合辽宁省区"},
                                                    {"name":"菁合河北省区"},
                                                    {"name":"菁合河南省区"},
                                                    {"name":"菁合山东省区"},
                                                    {"name":"菁合山西省区"},
                                                    {"name":"菁合吉林省区"},
                                                    {"name":"菁合黑龙江省区"}
                                                ]
                                            },
                                            {
                                                "name":"菁合南大区",
                                                "children":[
                                                    {"name":"菁合湖北省区"},
                                                    {"name":"菁合广东省区"},
                                                    {"name":"菁合江西省区"},
                                                    {"name":"菁合安徽省区"},
                                                    {"name":"菁合浙江省区"},
                                                    {"name":"菁合上海省区"},
                                                    {"name":"菁合湖南省区"},
                                                    {"name":"菁合福建省区"},
                                                    {"name":"菁合苏北省区"},
                                                    {"name":"菁合苏南省区"}
                                                ]
                                            },
                                            {
                                                "name":"菁合西大区",
                                                "children":[
                                                    {"name":"菁合重庆省区"},
                                                    {"name":"菁合贵州省区"},
                                                    {"name":"菁合甘肃省区"},
                                                    {"name":"菁合宁夏省区"},
                                                    {"name":"菁合青海省区"},
                                                    {"name":"菁合四川省区"},
                                                    {"name":"菁合广西省区"},
                                                    {"name":"菁合陕西省区"},
                                                    {"name":"菁合新疆省区"},
                                                    {"name":"菁合云南省区"}
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "name":"精盟事业部",
                                        "children":[
                                            {
                                                "name":"精盟南大区",
                                                "children":[
                                                    {"name":"精盟甘肃省区"},
                                                    {"name":"精盟宁夏省区"},
                                                    {"name":"精盟青海省区"},
                                                    {"name":"精盟陕西省区"},
                                                    {"name":"精盟新疆省区"},
                                                    {"name":"精盟广西省区"},
                                                    {"name":"精盟西藏省区"},
                                                    {"name":"精盟重庆省区"},
                                                    {"name":"精盟贵州省区"},
                                                    {"name":"精盟四川省区"},
                                                    {"name":"精盟云南省区"},
                                                    {"name":"精盟上海省区"},
                                                    {"name":"精盟浙江省区"}
                                                ]
                                            },
                                            {
                                                "name":"精盟西大区",
                                                "children":[
                                                    {"name":"精盟江苏省区"},
                                                    {"name":"精盟安徽省区"},
                                                    {"name":"精盟福建省区"},
                                                    {"name":"精盟广东省区"},
                                                    {"name":"精盟湖北省区"},
                                                    {"name":"精盟江西省区"},
                                                    {"name":"精盟湖南省区"}
                                                ]
                                            },
                                            {
                                                "name":"精盟北大区",
                                                "children":[
                                                    {"name":"精盟辽宁省区"},
                                                    {"name":"精盟吉林省区"},
                                                    {"name":"精盟黑龙江省区"},
                                                    {"name":"精盟内蒙省区"},
                                                    {"name":"精盟河北省区"},
                                                    {"name":"精盟河南省区"},
                                                    {"name":"精盟山东省区"},
                                                    {"name":"精盟山西省区"}
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
            }
            ;

    var i = 0,
            duration = 750,
            rectW = 100,
            rectH = 30;

    var tree = d3.layout.tree().nodeSize([110, 40]);
    var diagonal = d3.svg.diagonal()
            .projection(function (d) {
                return [d.x + rectW / 2, d.y + rectH / 2];
            });

    var svg = d3.select("#body").append("svg").attr("width", 1000).attr("height", 1000)
            .call(zm = d3.behavior.zoom().scaleExtent([1,3]).on("zoom", redraw)).append("g")
            .attr("transform", "translate(" + 350 + "," + 20 + ")");

    //necessary so that zoom knows where to zoom and unzoom from
    zm.translate([350, 20]);

    root.x0 = 0;
    root.y0 = height / 2;

    function collapse(d) {
        if (d.children) {
            d._children = d.children;
            d._children.forEach(collapse);
            d.children = null;
        }
    }

    root.children.forEach(collapse);
    update(root);

    d3.select("#body").style("height", "800px");

    function update(source) {

        // Compute the new tree layout.
        var nodes = tree.nodes(root).reverse(),
                links = tree.links(nodes);

        // Normalize for fixed-depth.
        nodes.forEach(function (d) {
            d.y = d.depth * 180;
        });

        // Update the nodes…
        var node = svg.selectAll("g.node")
                .data(nodes, function (d) {
                    return d.id || (d.id = ++i);
                });

        // Enter any new nodes at the parent's previous position.
        var nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", function (d) {
                    return "translate(" + source.x0 + "," + source.y0 + ")";
                })
                .on("click", click);

        nodeEnter.append("rect")
                .attr("width", rectW)
                .attr("height", rectH)
                .attr("stroke", "black")
                .attr("stroke-width", 1)
                .style("fill", function (d) {
                    return d._children ? "lightsteelblue" : "#fff";
                });

        nodeEnter.append("text")
                .attr("x", rectW / 2)
                .attr("y", rectH / 2)
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .text(function (d) {
                    return d.name;
                });

        // Transition nodes to their new position.
        var nodeUpdate = node.transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });

        nodeUpdate.select("rect")
                .attr("width", rectW)
                .attr("height", rectH)
                .attr("stroke", "black")
                .attr("stroke-width", 1)
                .style("fill", function (d) {
                    return d._children ? "lightsteelblue" : "#fff";
                });

        nodeUpdate.select("text")
                .style("fill-opacity", 1);

        // Transition exiting nodes to the parent's new position.
        var nodeExit = node.exit().transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + source.x + "," + source.y + ")";
                })
                .remove();

        nodeExit.select("rect")
                .attr("width", rectW)
                .attr("height", rectH)
            //.attr("width", bbox.getBBox().width)""
            //.attr("height", bbox.getBBox().height)
                .attr("stroke", "black")
                .attr("stroke-width", 1);

        nodeExit.select("text");

        // Update the links…
        var link = svg.selectAll("path.link")
                .data(links, function (d) {
                    return d.target.id;
                });

        // Enter any new links at the parent's previous position.
        link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("x", rectW / 2)
                .attr("y", rectH / 2)
                .attr("d", function (d) {
                    var o = {
                        x: source.x0,
                        y: source.y0
                    };
                    return diagonal({
                        source: o,
                        target: o
                    });
                });

        // Transition links to their new position.
        link.transition()
                .duration(duration)
                .attr("d", diagonal);

        // Transition exiting nodes to the parent's new position.
        link.exit().transition()
                .duration(duration)
                .attr("d", function (d) {
                    var o = {
                        x: source.x,
                        y: source.y
                    };
                    return diagonal({
                        source: o,
                        target: o
                    });
                })
                .remove();

        // Stash the old positions for transition.
        nodes.forEach(function (d) {
            d.x0 = d.x;
            d.y0 = d.y;
        });
    }

    // Toggle children on click.
    function click(d) {
        if (d.children) {
            d._children = d.children;
            d.children = null;
        } else {
            d.children = d._children;
            d._children = null;
        }
        update(d);
    }

    //Redraw for zoom
    function redraw() {
        //console.log("here", d3.event.translate, d3.event.scale);
        svg.attr("transform",
                "translate(" + d3.event.translate + ")"
                + " scale(" + d3.event.scale + ")");
    }

</script>

</body>
</html>